import{d as D,k as $,l as V,c as s,o as l,u as t,C as _,w as r,b as m,m as O,n as A,p as R,B as k,f,q as M,s as I,v as T,U as P,D as B,h as c,a as n,e as g,i as b,t as N,x as w,T as x,F,y as G,O as i,S as q,z as U,E as z,_ as W}from"./index-BEbl4hGz.js";const j=D({__name:"AddWorkLogForm",props:{orderId:{type:Number,required:!0}},emits:["log-added"],setup(o,{emit:p}){const E=o,u=p,d=$(),y=V({log_content:""}),e=$(!1),a=async()=>{var C,v,S;e.value=!0;try{await M.addWorkLog(E.orderId,{log_content:y.log_content}),I.success("工作日志提交成功"),y.log_content="",(C=d.value)==null||C.clearValidate(),u("log-added")}catch(L){I.error(((S=(v=L.response)==null?void 0:v.data)==null?void 0:S.msg)||"日志提交失败")}finally{e.value=!1}};return(C,v)=>(l(),s(t(_),{title:"添加工作日志"},{default:r(()=>[m(t(O),{model:y,layout:"vertical",onFinish:a,ref_key:"formRef",ref:d},{default:r(()=>[m(t(A),{label:"日志内容",name:"log_content",rules:[{required:!0,message:"日志内容不能为空"}]},{default:r(()=>[m(t(R),{value:y.log_content,"onUpdate:value":v[0]||(v[0]=S=>y.log_content=S),rows:4,placeholder:"请填写工作进展..."},null,8,["value"])]),_:1}),m(t(A),null,{default:r(()=>[m(t(k),{type:"primary","html-type":"submit",loading:e.value},{default:r(()=>v[1]||(v[1]=[f("提交日志",-1)])),_:1,__:[1]},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}))}}),H={style:{"font-weight":"bold",color:"#d48806"}},Y={style:{"font-weight":"bold",color:"#3f8600"}},J={key:0},K={style:{"font-weight":"bold",color:"#3f8600"}},Q={key:0},X=D({__name:"FinanceSummaryCard",props:{order:{type:Object,required:!0}},setup(o){const p=o,E=T(()=>p.order.commissions.find(y=>y.role_at_time===P.CUSTOMER_SERVICE)),u=T(()=>p.order.commissions.find(y=>y.role_at_time===P.DEVELOPER)),d=async y=>{try{await navigator.clipboard.writeText(y),I.success("已复制到剪贴板！")}catch{I.error("复制失败")}};return(y,e)=>(l(),s(t(_),{title:"财务结算摘要",bordered:!1,style:{"background-color":"#fafafa"}},{default:r(()=>[m(t(B),{column:1,layout:"horizontal",bordered:"",size:"small"},{default:r(()=>[m(t(g),{label:"订单总金额"},{default:r(()=>[b("span",H,N(o.order.final_price??"N/A")+" 元",1)]),_:1}),m(t(g),{label:`客服提成 (${o.order.creator.full_name})`},{default:r(()=>{var a;return[b("span",Y,N(((a=E.value)==null?void 0:a.amount)??0)+" 元",1)]}),_:1},8,["label"]),m(t(g),{label:"客服收款账号"},{default:r(()=>{var a;return[(a=o.order.creator)!=null&&a.financial_account?(l(),c("div",J,[m(t(w),{onClick:e[0]||(e[0]=C=>d(o.order.creator.financial_account)),style:{cursor:"pointer",color:"#1890ff","margin-right":"8px"}}),b("span",null,N(o.order.creator.financial_account),1)])):(l(),s(t(x),{key:1,color:"warning"},{default:r(()=>e[2]||(e[2]=[f("未提供",-1)])),_:1,__:[2]}))]}),_:1}),o.order.developer?(l(),c(F,{key:0},[m(t(g),{label:`技术提成 (${o.order.developer.full_name})`},{default:r(()=>{var a;return[b("span",K,N(((a=u.value)==null?void 0:a.amount)??0)+" 元",1)]}),_:1},8,["label"]),m(t(g),{label:"技术收款账号"},{default:r(()=>[o.order.developer.financial_account?(l(),c("div",Q,[m(t(w),{onClick:e[1]||(e[1]=a=>d(o.order.developer.financial_account)),style:{cursor:"pointer",color:"#1890ff","margin-right":"8px"}}),b("span",null,N(o.order.developer.financial_account),1)])):(l(),s(t(x),{key:1,color:"warning"},{default:r(()=>e[3]||(e[3]=[f("未提供",-1)])),_:1,__:[3]}))]),_:1})],64)):n("",!0)]),_:1})]),_:1}))}}),Z={class:"sidebar"},h={key:0},ee={key:1},te={key:2},oe=D({__name:"OrderActionPanel",props:{order:{type:Object,required:!0}},emits:["update-status","open-price-modal","open-assign-modal","reload-order","open-commission-modal"],setup(o,{emit:p}){const E=o,u=p,d=G(T(()=>E.order));return(y,e)=>(l(),c("div",Z,[o.order?(l(),c(F,{key:0},[t(d).isFinance.value&&[t(i).PENDING_SETTLEMENT,t(i).VERIFIED].includes(o.order.status)?(l(),s(X,{key:0,order:o.order,style:{"margin-bottom":"16px"}},null,8,["order"])):n("",!0),!o.order.is_locked||t(d).isSuperAdmin.value?(l(),s(t(_),{key:1,title:"下一步操作"},{default:r(()=>[m(t(q),{direction:"vertical",style:{width:"100%"}},{default:r(()=>[t(d).isCS.value&&!o.order.is_locked?(l(),c("div",h,[o.order.status===t(i).PENDING_ASSIGNMENT?(l(),s(t(k),{key:0,onClick:e[0]||(e[0]=a=>u("update-status",t(i).PENDING_PAYMENT)),type:"primary",block:""},{default:r(()=>e[12]||(e[12]=[f("更新为 [待付款]",-1)])),_:1,__:[12]})):n("",!0),o.order.status===t(i).PENDING_PAYMENT?(l(),s(t(k),{key:1,onClick:e[1]||(e[1]=a=>u("update-status",t(i).PAID)),type:"primary",block:""},{default:r(()=>e[13]||(e[13]=[f("确认收款 (进入已付款)",-1)])),_:1,__:[13]})):n("",!0),o.order.status===t(i).PAID?(l(),s(t(k),{key:2,onClick:e[2]||(e[2]=a=>u("update-status",t(i).IN_DEVELOPMENT)),type:"primary",block:""},{default:r(()=>e[14]||(e[14]=[f("分配技术/开始开发",-1)])),_:1,__:[14]})):n("",!0),o.order.status===t(i).IN_DEVELOPMENT?(l(),s(t(k),{key:3,onClick:e[3]||(e[3]=a=>u("update-status",t(i).SHIPPED)),type:"primary",block:""},{default:r(()=>e[15]||(e[15]=[f("更新为 [已发货]",-1)])),_:1,__:[15]})):n("",!0),o.order.status===t(i).SHIPPED?(l(),s(t(k),{key:4,onClick:e[4]||(e[4]=a=>u("update-status",t(i).RECEIVED)),type:"primary",block:""},{default:r(()=>e[16]||(e[16]=[f("确认 [已收货]",-1)])),_:1,__:[16]})):n("",!0)])):n("",!0),t(d).isTech.value?(l(),c("div",ee,[t(d).canSettleByTech.value?(l(),s(t(k),{key:0,onClick:e[5]||(e[5]=a=>u("update-status",t(i).PENDING_SETTLEMENT)),type:"primary",block:""},{default:r(()=>e[17]||(e[17]=[f(" 确认可结算 (进入待审核) ",-1)])),_:1,__:[17]})):n("",!0)])):n("",!0),t(d).isFinance.value?(l(),c("div",te,[o.order.status===t(i).PENDING_SETTLEMENT?(l(),s(t(k),{key:0,onClick:e[6]||(e[6]=a=>u("update-status",t(i).VERIFIED)),type:"primary",block:""},{default:r(()=>e[18]||(e[18]=[f("审核通过 (进入已核验)",-1)])),_:1,__:[18]})):n("",!0),o.order.status===t(i).VERIFIED?(l(),s(t(k),{key:1,onClick:e[7]||(e[7]=a=>u("update-status",t(i).SETTLED)),type:"primary",block:"",style:{"background-color":"#52c41a","border-color":"#52c41a"}},{default:r(()=>e[19]||(e[19]=[f("确认结算 (完成订单)",-1)])),_:1,__:[19]})):n("",!0)])):n("",!0),m(t(U),null,{default:r(()=>e[20]||(e[20]=[f("其他操作",-1)])),_:1,__:[20]}),t(d).isCS.value?(l(),s(t(k),{key:3,onClick:e[8]||(e[8]=a=>u("open-price-modal")),block:""},{default:r(()=>e[21]||(e[21]=[f("修改价格",-1)])),_:1,__:[21]})):n("",!0),t(d).isCS.value?(l(),s(t(k),{key:4,onClick:e[9]||(e[9]=a=>u("open-assign-modal")),block:""},{default:r(()=>e[22]||(e[22]=[f("分配/修改技术负责人",-1)])),_:1,__:[22]})):n("",!0),t(d).canSetSpecialCommission.value?(l(),s(t(k),{key:5,onClick:e[10]||(e[10]=a=>u("open-commission-modal")),block:"",danger:""},{default:r(()=>e[23]||(e[23]=[f("设置特殊提成",-1)])),_:1,__:[23]})):n("",!0)]),_:1})]),_:1})):n("",!0),o.order.is_locked&&!t(d).isSuperAdmin.value?(l(),s(t(_),{key:2,title:"订单已锁定"},{default:r(()=>[m(t(z),{message:"此订单已结算或已取消，无法进行任何操作。",type:"warning","show-icon":""})]),_:1})):n("",!0),t(d).canAddWorkLog.value?(l(),s(j,{key:3,"order-id":o.order.id,onLogAdded:e[11]||(e[11]=a=>u("reload-order")),style:{"margin-top":"16px"}},null,8,["order-id"])):n("",!0)],64)):n("",!0)]))}}),le=W(oe,[["__scopeId","data-v-c3be3ed6"]]);export{le as default};
